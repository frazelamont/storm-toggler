(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
'use strict';

var _stormToggler = require('./libs/storm-toggler');

var _stormToggler2 = _interopRequireDefault(_stormToggler);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var onDOMContentLoadedTasks = [function () {
	_stormToggler2.default.init('.js-toggle');
	global.Togglers = _stormToggler2.default.init('.js-toggle-local', {
		targetLocal: true,
		delay: 0,
		callback: function callback() {
			var _this = this;

			if (this.open) {
				global.Togglers.forEach(function (toggler) {
					if (toggler !== _this && !!toggler.open && toggler.DOMElement !== _this.targetElement) {
						toggler.toggle();
					}
				});
			}
		}
	});
}];

global.Togglers = {};

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
	onDOMContentLoadedTasks.forEach(function (fn) {
		return fn();
	});
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./libs/storm-toggler":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * @name storm-toggler: Class and ARIA toggle UI state manipulation
 * @version 0.11.0: Tue, 14 Feb 2017 12:22:16 GMT
 * @author mjbp
 * @license MIT
 */
var defaults = {
	delay: 0,
	targetLocal: false,
	prehook: false,
	callback: false,
	focus: true,
	trapTab: false
};

var StormToggler = {
	init: function init() {
		var _this = this;

		this.targetElement = document.getElementById(this.targetId);
		this.classTarget = !this.settings.targetLocal ? document.documentElement : this.targetElement.parentNode;
		this.siblingBtns = [].slice.call(document.querySelectorAll('[href*="#' + this.targetId + '"], [data-target*="#' + this.targetId + '"]'));
		if (this.settings.focus) this.focusableChildren = this.getFocusableChildren();
		if (this.settings.trapTab) this.boundKeyListener = this.keyListener.bind(this);

		this.statusClass = !this.settings.targetLocal ? 'on--' + this.targetId : 'active';
		this.animatingClass = !this.settings.targetLocal ? 'animating--' + this.targetId : 'animating';

		this.siblingBtns.forEach(function (btn) {
			btn.setAttribute('role', 'button');
			btn.setAttribute('aria-controls', _this.targetId);
			btn.setAttribute('aria-expanded', 'false');
		});

		this.btn.addEventListener('click', function (e) {
			_this.toggle(e);
		});

		return this;
	},
	getFocusableChildren: function getFocusableChildren() {
		var focusableElements = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex="-1"])'];

		return [].slice.call(this.targetElement.querySelectorAll(focusableElements.join(',')));
	},

	toggleAttributes: function toggleAttributes() {
		this.isOpen = !this.isOpen;
		this.siblingBtns.forEach(function (sibling) {
			sibling.setAttribute('aria-expanded', sibling.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
		});
	},
	toggleDocumentState: function toggleDocumentState() {
		this.classTarget.classList.remove(this.animatingClass);
		this.classTarget.classList.toggle(this.statusClass);
	},
	manageFocus: function manageFocus() {
		var _this2 = this;

		if (!this.isOpen) {
			this.lastFocused = document.activeElement;
			this.focusableChildren.length && window.setTimeout(function () {
				return _this2.focusableChildren[0].focus();
			}, this.settings.delay);
			this.settings.trapTab && document.addEventListener('keydown', this.boundKeyListener);
		} else {
			this.settings.trapTab && document.removeEventListener('keydown', this.boundKeyListener);
			this.focusableChildren.length && window.setTimeout(function () {
				_this2.lastFocused.focus();
				_this2.lastFocused = false;
			}, this.settings.delay);
		}
	},
	trapTab: function trapTab(e) {
		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);
		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				e.preventDefault();
				this.focusableChildren[0].focus();
			}
		}
	},
	keyListener: function keyListener(e) {
		if (this.isOpen && e.keyCode === 27) {
			e.preventDefault();
			this.toggle();
		}
		if (this.isOpen && e.keyCode === 9) {
			this.trapTab(e);
		}
	},

	toggle: function toggle(e) {
		var _this3 = this;

		var delay = this.classTarget.classList.contains(this.statusClass) ? this.settings.delay : 0;

		!!this.settings.prehook && typeof this.settings.prehook === 'function' && this.settings.prehook.call(this);

		if (e) {
			e.preventDefault();
			e.stopPropagation();
		}

		this.classTarget.classList.add(this.animatingClass);

		window.setTimeout(function () {
			!!_this3.settings.focus && _this3.focusableChildren && _this3.manageFocus();
			_this3.toggleAttributes();
			_this3.toggleDocumentState();
			!!_this3.settings.callback && typeof _this3.settings.callback === 'function' && _this3.settings.callback.call(_this3);
		}, delay);
	}
};

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (!els.length) throw new Error('Toggler cannot be initialised, no augmentable elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(StormToggler), {
			btn: el,
			targetId: (el.getAttribute('href') || el.getAttribute('data-target')).substr(1),
			settings: Object.assign({}, defaults, opts)
		}).init();
	});
};

exports.default = { init: init };

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL3N0b3JtLXRvZ2dsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUNBQTs7Ozs7O0FBRUEsSUFBTSwwQkFBMEIsQ0FBQyxZQUFNO0FBQ3RDLHdCQUFRLElBQVIsQ0FBYSxZQUFiO0FBQ0EsUUFBTyxRQUFQLEdBQWlCLHVCQUFRLElBQVIsQ0FBYSxrQkFBYixFQUFpQztBQUNqRCxlQUFhLElBRG9DO0FBRWpELFNBQU8sQ0FGMEM7QUFHakQsWUFBVSxvQkFBVztBQUFBOztBQUNwQixPQUFHLEtBQUssSUFBUixFQUFhO0FBQ1osV0FBTyxRQUFQLENBQWdCLE9BQWhCLENBQXdCLG1CQUFXO0FBQ2xDLFNBQUcscUJBQW9CLENBQUMsQ0FBQyxRQUFRLElBQTlCLElBQXNDLFFBQVEsVUFBUixLQUF1QixNQUFLLGFBQXJFLEVBQW1GO0FBQ2xGLGNBQVEsTUFBUjtBQUNBO0FBQ0QsS0FKRDtBQUtBO0FBQ0Q7QUFYZ0QsRUFBakMsQ0FBakI7QUFhQSxDQWYrQixDQUFoQzs7QUFpQkEsT0FBTyxRQUFQLEdBQWtCLEVBQWxCOztBQUVBLElBQUcsc0JBQXNCLE1BQXpCLEVBQWlDLE9BQU8sZ0JBQVAsQ0FBd0Isa0JBQXhCLEVBQTRDLFlBQU07QUFBRSx5QkFBd0IsT0FBeEIsQ0FBZ0MsVUFBQyxFQUFEO0FBQUEsU0FBUSxJQUFSO0FBQUEsRUFBaEM7QUFBZ0QsQ0FBcEc7Ozs7Ozs7Ozs7QUNyQmpDOzs7Ozs7QUFNQSxJQUFNLFdBQVc7QUFDaEIsUUFBTyxDQURTO0FBRWhCLGNBQWEsS0FGRztBQUdoQixVQUFTLEtBSE87QUFJaEIsV0FBVSxLQUpNO0FBS2hCLFFBQU8sSUFMUztBQU1oQixVQUFTO0FBTk8sQ0FBakI7O0FBU0EsSUFBTSxlQUFlO0FBQ3BCLEtBRG9CLGtCQUNiO0FBQUE7O0FBQ04sT0FBSyxhQUFM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QUFKLENBQVEsVUFBQyxFQUFELEVBQVE7QUFDdEIsU0FBTyxPQUFPLE1BQVAsQ0FBYyxPQUFPLE1BQVAsQ0FBYyxZQUFkLENBQWQsRUFBMkM7QUFDakQsUUFBSyxFQUQ0QztBQUVqRCxhQUFVLENBQUMsR0FBRyxZQUFILENBQWdCLE1BQWhCLEtBQTBCLEdBQUcsWUFBSCxDQUFnQixhQUFoQixDQUEzQixFQUEyRCxNQUEzRCxDQUFrRSxDQUFsRSxDQUZ1QztBQUdqRCxhQUFVLE9BQU8sTUFBUCxDQUFjLEVBQWQsRUFBa0IsUUFBbEIsRUFBNEIsSUFBNUI7QUFIdUMsR0FBM0MsRUFJSixJQUpJLEVBQVA7QUFLQSxFQU5NLENBQVA7QUFPQSxDQVpEOztrQkFjZSxFQUFFLFVBQUYsRSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgVG9nZ2xlciBmcm9tICcuL2xpYnMvc3Rvcm0tdG9nZ2xlcic7XG5cbmNvbnN0IG9uRE9NQ29udGVudExvYWRlZFRhc2tzID0gWygpID0+IHtcblx0VG9nZ2xlci5pbml0KCcuanMtdG9nZ2xlJyk7XG5cdGdsb2JhbC5Ub2dnbGVycyA9VG9nZ2xlci5pbml0KCcuanMtdG9nZ2xlLWxvY2FsJywge1xuXHRcdHRhcmdldExvY2FsOiB0cnVlLFxuXHRcdGRlbGF5OiAwLFxuXHRcdGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdGlmKHRoaXMub3Blbil7XG5cdFx0XHRcdGdsb2JhbC5Ub2dnbGVycy5mb3JFYWNoKHRvZ2dsZXIgPT4ge1xuXHRcdFx0XHRcdGlmKHRvZ2dsZXIgIT09IHRoaXMgJiYgISF0b2dnbGVyLm9wZW4gJiYgdG9nZ2xlci5ET01FbGVtZW50ICE9PSB0aGlzLnRhcmdldEVsZW1lbnQpe1xuXHRcdFx0XHRcdFx0dG9nZ2xlci50b2dnbGUoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59XTtcblxuZ2xvYmFsLlRvZ2dsZXJzID0ge307XG4gICAgXG5pZignYWRkRXZlbnRMaXN0ZW5lcicgaW4gd2luZG93KSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsgb25ET01Db250ZW50TG9hZGVkVGFza3MuZm9yRWFjaCgoZm4pID0+IGZuKCkpOyB9KTtcbiIsIi8qKlxuICogQG5hbWUgc3Rvcm0tdG9nZ2xlcjogQ2xhc3MgYW5kIEFSSUEgdG9nZ2xlIFVJIHN0YXRlIG1hbmlwdWxhdGlvblxuICogQHZlcnNpb24gMC4xMS4wOiBUdWUsIDE0IEZlYiAyMDE3IDEyOjIyOjE2IEdNVFxuICogQGF1dGhvciBtamJwXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuY29uc3QgZGVmYXVsdHMgPSB7XG5cdGRlbGF5OiAwLFxuXHR0YXJnZXRMb2NhbDogZmFsc2UsXG5cdHByZWhvb2s6IGZhbHNlLFxuXHRjYWxsYmFjazogZmFsc2UsXG5cdGZvY3VzOiB0cnVlLFxuXHR0cmFwVGFiOiBmYWxzZVxufTtcblxuY29uc3QgU3Rvcm1Ub2dnbGVyID0ge1xuXHRpbml0KCkge1xuXHRcdHRoaXMudGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudGFyZ2V0SWQpO1xuXHRcdHRoaXMuY2xhc3NUYXJnZXQgPSAoIXRoaXMuc2V0dGluZ3MudGFyZ2V0TG9jYWwpID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IDogdGhpcy50YXJnZXRFbGVtZW50LnBhcmVudE5vZGU7XG5cdFx0dGhpcy5zaWJsaW5nQnRucyA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2hyZWYqPVwiIycgKyB0aGlzLnRhcmdldElkICsgJ1wiXSwgW2RhdGEtdGFyZ2V0Kj1cIiMnICsgdGhpcy50YXJnZXRJZCArICdcIl0nKSk7XG5cdFx0aWYodGhpcy5zZXR0aW5ncy5mb2N1cykgdGhpcy5mb2N1c2FibGVDaGlsZHJlbiA9IHRoaXMuZ2V0Rm9jdXNhYmxlQ2hpbGRyZW4oKTtcblx0XHRpZih0aGlzLnNldHRpbmdzLnRyYXBUYWIpIHRoaXMuYm91bmRLZXlMaXN0ZW5lciA9IHRoaXMua2V5TGlzdGVuZXIuYmluZCh0aGlzKTtcblxuXHRcdHRoaXMuc3RhdHVzQ2xhc3MgPSAhdGhpcy5zZXR0aW5ncy50YXJnZXRMb2NhbCA/IGBvbi0tJHt0aGlzLnRhcmdldElkfWAgOiAnYWN0aXZlJztcblx0XHR0aGlzLmFuaW1hdGluZ0NsYXNzID0gIXRoaXMuc2V0dGluZ3MudGFyZ2V0TG9jYWwgPyBgYW5pbWF0aW5nLS0ke3RoaXMudGFyZ2V0SWR9YCA6ICdhbmltYXRpbmcnO1xuXG5cdFx0dGhpcy5zaWJsaW5nQnRucy5mb3JFYWNoKGJ0biA9PiB7XG5cdFx0XHRidG4uc2V0QXR0cmlidXRlKCdyb2xlJywnYnV0dG9uJyk7XG5cdFx0XHRidG4uc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgdGhpcy50YXJnZXRJZCk7XG5cdFx0XHRidG4uc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4geyB0aGlzLnRvZ2dsZShlKTsgfSk7XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cdGdldEZvY3VzYWJsZUNoaWxkcmVuKCkge1xuXHRcdGNvbnN0IGZvY3VzYWJsZUVsZW1lbnRzID0gWydhW2hyZWZdJywgJ2FyZWFbaHJlZl0nLCAnaW5wdXQ6bm90KFtkaXNhYmxlZF0pJywgJ3NlbGVjdDpub3QoW2Rpc2FibGVkXSknLCAndGV4dGFyZWE6bm90KFtkaXNhYmxlZF0pJywgJ2J1dHRvbjpub3QoW2Rpc2FibGVkXSknLCAnaWZyYW1lJywgJ29iamVjdCcsICdlbWJlZCcsICdbY29udGVudGVkaXRhYmxlXScsICdbdGFiaW5kZXhdOm5vdChbdGFiaW5kZXg9XCItMVwiXSknXTtcblxuXHRcdHJldHVybiBbXS5zbGljZS5jYWxsKHRoaXMudGFyZ2V0RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGZvY3VzYWJsZUVsZW1lbnRzLmpvaW4oJywnKSkpO1xuXHR9LFxuXHR0b2dnbGVBdHRyaWJ1dGVzOiBmdW5jdGlvbigpe1xuXHRcdHRoaXMuaXNPcGVuID0gIXRoaXMuaXNPcGVuO1xuXHRcdHRoaXMuc2libGluZ0J0bnMuZm9yRWFjaChzaWJsaW5nID0+IHtcblx0XHRcdHNpYmxpbmcuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgc2libGluZy5nZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnKSA9PT0gJ3RydWUnID8gJ2ZhbHNlJyA6ICd0cnVlJyk7XG5cdFx0fSk7XG5cdH0sXG5cdHRvZ2dsZURvY3VtZW50U3RhdGU6IGZ1bmN0aW9uKCl7XG5cdFx0dGhpcy5jbGFzc1RhcmdldC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuYW5pbWF0aW5nQ2xhc3MpO1xuXHRcdHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLnN0YXR1c0NsYXNzKTtcblx0fSxcblx0bWFuYWdlRm9jdXM6IGZ1bmN0aW9uKCl7XG5cdFx0aWYoIXRoaXMuaXNPcGVuKXtcblx0XHRcdHRoaXMubGFzdEZvY3VzZWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHRcdFx0dGhpcy5mb2N1c2FibGVDaGlsZHJlbi5sZW5ndGggJiYgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5mb2N1c2FibGVDaGlsZHJlblswXS5mb2N1cygpLCB0aGlzLnNldHRpbmdzLmRlbGF5KTtcblx0XHRcdHRoaXMuc2V0dGluZ3MudHJhcFRhYiAmJiBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZEtleUxpc3RlbmVyKTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHR0aGlzLnNldHRpbmdzLnRyYXBUYWIgJiYgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuYm91bmRLZXlMaXN0ZW5lcik7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAmJiB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRoaXMubGFzdEZvY3VzZWQuZm9jdXMoKTtcblx0XHRcdFx0dGhpcy5sYXN0Rm9jdXNlZCA9IGZhbHNlO1xuXHRcdFx0fSwgdGhpcy5zZXR0aW5ncy5kZWxheSk7XG5cdFx0fVxuXHR9LFxuXHR0cmFwVGFiOiBmdW5jdGlvbihlKXtcblx0XHRsZXQgZm9jdXNlZEluZGV4ID0gdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpO1xuXHRcdGlmKGUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSAwKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuW3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMV0uZm9jdXMoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYoIWUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXHRrZXlMaXN0ZW5lcihlKXtcblx0XHRpZiAodGhpcy5pc09wZW4gJiYgZS5rZXlDb2RlID09PSAyNykge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy50b2dnbGUoKTtcblx0XHR9XG5cdFx0aWYgKHRoaXMuaXNPcGVuICYmIGUua2V5Q29kZSA9PT0gOSkge1xuXHRcdFx0dGhpcy50cmFwVGFiKGUpO1xuXHRcdH1cblx0fSxcblx0dG9nZ2xlOiBmdW5jdGlvbihlKXtcblx0XHRsZXQgZGVsYXkgPSB0aGlzLmNsYXNzVGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyh0aGlzLnN0YXR1c0NsYXNzKSA/ICB0aGlzLnNldHRpbmdzLmRlbGF5IDogMDtcblxuXHRcdCghIXRoaXMuc2V0dGluZ3MucHJlaG9vayAmJiB0eXBlb2YgdGhpcy5zZXR0aW5ncy5wcmVob29rID09PSAnZnVuY3Rpb24nKSAmJiB0aGlzLnNldHRpbmdzLnByZWhvb2suY2FsbCh0aGlzKTtcblx0XHRcblx0XHRpZihlKXtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LmFkZCh0aGlzLmFuaW1hdGluZ0NsYXNzKTtcblx0XHRcblx0XHR3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHQoISF0aGlzLnNldHRpbmdzLmZvY3VzICYmIHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4pICYmIHRoaXMubWFuYWdlRm9jdXMoKTtcblx0XHRcdHRoaXMudG9nZ2xlQXR0cmlidXRlcygpO1xuXHRcdFx0dGhpcy50b2dnbGVEb2N1bWVudFN0YXRlKCk7XG5cdFx0XHQoISF0aGlzLnNldHRpbmdzLmNhbGxiYWNrICYmIHR5cGVvZiB0aGlzLnNldHRpbmdzLmNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSAmJiB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmNhbGwodGhpcyk7XG5cdFx0fSwgZGVsYXkpO1xuXHR9XG59O1xuXG5jb25zdCBpbml0ID0gKHNlbCwgb3B0cykgPT4ge1xuXHRsZXQgZWxzID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbCkpO1xuXHRcblx0aWYoIWVscy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcignVG9nZ2xlciBjYW5ub3QgYmUgaW5pdGlhbGlzZWQsIG5vIGF1Z21lbnRhYmxlIGVsZW1lbnRzIGZvdW5kJyk7XG5cblx0cmV0dXJuIGVscy5tYXAoKGVsKSA9PiB7XG5cdFx0cmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShTdG9ybVRvZ2dsZXIpLCB7XG5cdFx0XHRidG46IGVsLFxuXHRcdFx0dGFyZ2V0SWQ6IChlbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKXx8IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnKSkuc3Vic3RyKDEpLFxuXHRcdFx0c2V0dGluZ3M6IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzLCBvcHRzKVxuXHRcdH0pLmluaXQoKTtcblx0fSk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCB7IGluaXQgfTsiXX0=
